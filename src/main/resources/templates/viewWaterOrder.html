<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="http://cdn.staticfile.org/jquery/3.6.0/jquery.js"></script>
    <script th:inline="javascript">
        $(function(){
            var pageNum = 1;
            var pageSize = 5;
            var lastPage;
            var buildingId;
            var roomId;

            viewAllWaterOrder(pageNum, pageSize, setSelect);
            var curView = "viewAllWaterOrder";

            $("#body").on("click", ".pageButton", function(){
                var beforePage = pageNum;
                var value = $(this).attr("value");
                if(value == "首页"){
                    pageNum = 1;
                }else if(value == "尾页"){
                    pageNum = lastPage;
                }else if(value == "上一页"){
                    if(pageNum != 1){
                        pageNum--;
                    }else{
                        alert("这是首页!")
                    }
                }else if(value == "下一页"){
                    if(pageNum != lastPage){
                        pageNum++;
                    }else{
                        alert("这是最后一页了!")
                    }
                }else if(value = "跳转"){
                    pageNum = $("#page").val();
                }
                if(beforePage != pageNum){
                    $("#option"+pageNum).prop("selected",true)  // 设置select标签跟随页码
                    if(curView == "viewAllWaterOrder"){
                        viewAllWaterOrder(pageNum, pageSize, null)
                    }else if(curView == "viewBuildingWaterOrder"){
                        viewBuildingWaterOrder(buildingId, pageNum, pageSize, null);
                    }else if(curView == "viewRoomWaterOrder"){
                        viewRoomWaterOrder(buildingId, roomId, pageNum, pageSize, null);
                    }
                }
            })

            $("#search").click(function(){
                buildingId = $("#building").val()
                var floor = $("#floor").val();
                var room = $("#room").val();
                roomId = floor + room;
                if(buildingId != "null"){
                    if(floor != "null" && room != "null"){
                        pageNum = 1;
                        viewRoomWaterOrder(buildingId, roomId, pageNum, pageSize, setSelect);
                        curView = "viewRoomWaterOrder"
                    }else if(floor == "null" && room == "null"){
                        pageNum = 1;
                        viewBuildingWaterOrder(buildingId, pageNum, pageSize, setSelect);
                        curView = "viewBuildingWaterOrder";
                    }else {
                        alert("请确认查找信息")
                    }
                }else {
                    alert("请确认查找信息")
                }
            })

            $("#viewAll").click(function(){
                viewAllWaterOrder(pageNum, pageSize, setSelect);
                curView = "viewAllWaterOrder";
                $(".firstOption").prop("selected",true)
            })

            function viewAllWaterOrder(pageNum, pageSize, setSelect){
                $("#table>tbody").html("");  // 清空表格
                $.ajax({
                    url:"getAllWaterOrder?pageNum=" + pageNum + "&pageSize=" + pageSize,
                    async: false,
                    method: 'post',
                    success:function(data) {
                        if(setSelect != null){
                            setSelect(data);
                        }
                        view(data);
                        lastPage = data.navigateLastPage;
                    }
                })
            }

            function viewBuildingWaterOrder(buildingId, pageNum, pageSize, setSelect){
                $("#table>tbody").html("");  // 清空表格
                $.ajax({
                    url:"getBuildingWaterOrder?buildingId=" + buildingId + "&pageNum=" + pageNum + "&pageSize=" + pageSize,
                    async: false,
                    method: 'post',
                    success:function(data) {
                        if(setSelect != null){
                            setSelect(data);
                        }
                        view(data);
                        lastPage = data.navigateLastPage;
                    }
                })
            }

            function viewRoomWaterOrder(buildingId, roomId, pageNum, pageSize, setSelect){
                $("#table>tbody").html("");  // 清空表格
                $.ajax({
                    url:"getRoomWaterOrder?buildingId=" + buildingId + "&roomId=" + roomId + "&pageNum=" + pageNum + "&pageSize=" + pageSize,
                    async: false,
                    method: 'post',
                    success:function(data) {
                        if(setSelect != null){
                            setSelect(data);
                        }
                        view(data);
                        lastPage = data.navigateLastPage;
                    }
                })
            }
        })


        function view(data){
            $.each(data.list, function(index, waterOrder) {
                var tr = $("<tr>"
                    + "<td>" + waterOrder.buildingId + "</td>"
                    + "<td>" + waterOrder.roomId + "</td>"
                    + "<td>" + waterOrder.username + "</td>"
                    + "<td> " + waterOrder.number + "</td>"
                    + "<td>" + waterOrder.amount + "</td>"
                    + "<td>" + waterOrder.orderTime + "</td>"
                    + "</tr>");
                $("#table>tbody").append(tr);
            })
        }

        function setSelect(data){
            $("#page").html("");  // 清空
            $.each(data.navigatepageNums, function(index, navigatepageNum) {
                var option = $("<option id='option" + navigatepageNum + "'>" + navigatepageNum + "</option>");
                $("#page").append(option);
            })
        }

        function setBuildingSelect(data){
            $("#building").html("");  // 清空
            $.each(data, function(index, buildingId) {
                var option = $("<option value='" + buildingId + "'>#" + buildingId + "</option>");
                $("#building").append(option);
            })
        }

        function setFloorSelect(data){
            $("#floor").html("");  // 清空
            $.each(data, function(index, str) {
                var roomStr = str.split("");
                var option = $("<option value='" + roomStr[0] + "'>" + navigatepageNum + "</option>");
                $("#floor").append(option);
            })
        }

        function setRoomSelect(data){
            $("#room").html("");  // 清空
            $.each(data, function(index, str) {
                var roomStr = str.split("");
                var option = $("<option value='" + roomStr[1] + roomStr[2] + "'>" + navigatepageNum + "</option>");
                $("#room").append(option);
            })
        }

    </script>
</head>
    <body id="body">
        <form id="form">
            <table id="table">
                <thead>
                    <tr>
                        <th>楼栋</th>
                        <th>宿舍号</th>
                        <th>姓名</th>
                        <th>数量</th>
                        <th>金额</th>
                        <th>时间</th>
                    </tr>
                </thead>
                <tbody>

                </tbody>
            </table>
        </form>
        <input type="button" class="pageButton" value="首页">
        <input type="button" class="pageButton" value="上一页">
        <input type="button" class="pageButton" value="下一页">
        <input type="button" class="pageButton" value="尾页">
        <select id="page">
        </select>
        <input type="button" class="pageButton" value="跳转">
        <input type="button" id="viewAll" value="查看所有"><br>
        <form id="form2">
            <select id="building" >
                <option class="firstOption" selected="selected" value="null">==楼栋==</option>
                <option value="25">#25</option>
                <option value="26">#26</option>
                <option value="27">#27</option>
                <option value="28">#28</option>
                <option value="29">#29</option>
            </select>
            <select id="floor" >
                <option class="firstOption" selected="selected" value="null">==楼层==</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="5">6</option>
            </select>
            <select id="room" >
                <option class="firstOption" selected="selected" value="null">==房间==</option>
                <option value="01">01</option>
                <option value="02">02</option>
                <option value="03">03</option>
                <option value="04">04</option>
                <option value="05">05</option>
                <option value="06">06</option>
                <option value="07">07</option>
                <option value="08">08</option>
                <option value="09">09</option>
                <option value="10">10</option>
            </select>
            <input type="button" id="search" value="查询"><br>
        </form>
    </body>
</html>